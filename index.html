<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Heat maps</title>

<script src="cal-heatmap-master/jquery-3.4.1.min.js"></script>
<script src="cal-heatmap-master/d3.min.js"></script>

<link rel="stylesheet" href="cal-heatmap-master/cal-heatmap.css" />
<script type="text/javascript" src="cal-heatmap-master/cal-heatmap.js"></script>

</head>

<body>
    <br><br>
    <span>
        Select State
        <select id='states_field'>
            <option value="all">All States</option>
            <option value="AL">Alabama</option>
            <option value="AK">Alaska</option>
            <option value="AZ">Arizona</option>
            <option value="AR">Arkansas</option>
            <option value="CA">California</option>
            <option value="CO">Colorado</option>
            <option value="CT">Connecticut</option>
            <option value="DE">Delaware</option>
            <option value="DC">District Of Columbia</option>
            <option value="FL">Florida</option>
            <option value="GA">Georgia</option>
            <option value="HI">Hawaii</option>
            <option value="ID">Idaho</option>
            <option value="IL">Illinois</option>
            <option value="IN">Indiana</option>
            <option value="IA">Iowa</option>
            <option value="KS">Kansas</option>
            <option value="KY">Kentucky</option>
            <option value="LA">Louisiana</option>
            <option value="ME">Maine</option>
            <option value="MD">Maryland</option>
            <option value="MA">Massachusetts</option>
            <option value="MI">Michigan</option>
            <option value="MN">Minnesota</option>
            <option value="MS">Mississippi</option>
            <option value="MO">Missouri</option>
            <option value="MT">Montana</option>
            <option value="NE">Nebraska</option>
            <option value="NV">Nevada</option>
            <option value="NH">New Hampshire</option>
            <option value="NJ">New Jersey</option>
            <option value="NM">New Mexico</option>
            <option value="NY">New York</option>
            <option value="NC">North Carolina</option>
            <option value="ND">North Dakota</option>
            <option value="OH">Ohio</option>
            <option value="OK">Oklahoma</option>
            <option value="OR">Oregon</option>
            <option value="PA">Pennsylvania</option>
            <option value="RI">Rhode Island</option>
            <option value="SC">South Carolina</option>
            <option value="SD">South Dakota</option>
            <option value="TN">Tennessee</option>
            <option value="TX">Texas</option>
            <option value="UT">Utah</option>
            <option value="VT">Vermont</option>
            <option value="VA">Virginia</option>
            <option value="WA">Washington</option>
            <option value="WV">West Virginia</option>
            <option value="WI">Wisconsin</option>
            <option value="WY">Wyoming</option>
        </select>
        <button class="btn" id="domainDynamicDimension-previous"> PREVIOUS </button>
        <button class="btn" id="domainDynamicDimension-next">NEXT</button>
    </span>
    <br><br>
    <div id="pub-heatmap"></div>
    <br><br>
    <div id="resultClick"></div>

<script type="text/javascript">

var parser = function(data) {
	var stats = {};
	for (var d in data) {
		stats[data[d].date] = data[d].value;
	}
	return stats;
};


$(document).ready ( function(){


    $("#states_field").change(function(){
        console.log("The text has been changed."+ $("#states_field  option:selected").val());
        var selected_state=$("#states_field  option:selected").val();


    });

        d3.json("naturalization-ceremonies.json", function(data) {
            var dataForInput={};
            for (var i = 0; i < data.length; i++) {
                //console.log(data[i].date);

                if(data[i].date != undefined ){
                
                    var stateL=data[i].abbrev;
                    if(stateL != undefined){
                    //    var stateIs=stateL.trim().split(",")[1].trim().split(" ")[0];
                        var stateIs=stateL.substr(0, 2);
                       // console.log(stateL + "*****" + stateIs );
                    }
                
                
                    var dateIs = new Date(data[i].date);
                    var secondsIs = dateIs.getTime() / 1000;
                    if(dataForInput[secondsIs]==undefined){
                        dataForInput[secondsIs] =  1;
                    }else{
                        dataForInput[secondsIs] =  dataForInput[secondsIs] + 1;
                   }
               }
            }

            var pub = new CalHeatMap();
            pub.init({
                itemSelector: "#pub-heatmap",
                domain :"month",
                subDomain:"x_day",
                cellSize: 20,
                data:dataForInput,
                //afterLoadData: parser,
                subDomainTextFormat: "%d",
                domainGutter:5,
                range: 4,
                displayLegend: true,

                nextSelector: "#domainDynamicDimension-next",
                previousSelector: "#domainDynamicDimension-previous",
                onMinDomainReached: function(hit) {
                if (hit) {
                    $("#domainDynamicDimension-previous").attr("disabled", "disabled");
                } else {

                    $("#domainDynamicDimension-previous").attr("disabled", false);
                }
            },
            onMaxDomainReached: function(hit) {
                if (hit) {

                    $("#domainDynamicDimension-next").attr("disabled", "disabled");
                } else {

                    $("#domainDynamicDimension-next").attr("disabled", false);
                }
            },


                rowLimit: 6,
                tooltip: true,
                start: new Date(2020, 0, 1),
                minDate: new Date(2020, 0, 1),
                maxDate: new Date(2020, 11,31),

                legendColors: ["#ecf5e2", "#232181"],
                legend: [1, 2, 3, 4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],

                onClick: function(date, nb) {
                   // console.log('okok');
                    $("#resultClick").html("Details <br> Date: <b>" +
                            date + "</b><br/>Total Events: <b>" +
                        (nb === null ? "0" : nb) + "</b>"
                    );

                    var d1=date.getDate();
                    var m1=date.getMonth();
                    var y1=date.getFullYear();

                    //console.log(d1);
                   // console.log(Date.parse(date.toString());
                    //console.log(selectedDateSec);
                    var eventNum=1;
                    for (var i = 0; i < data.length; i++) {

                       if(data[i].date != undefined ){
                            var dateTo=new Date(data[i].date);
                            var d2=dateTo.getDate();
                            var m2=dateTo.getMonth();
                            var y2=dateTo.getFullYear();
                            if (d1 == d2 && m1==m2 && y1==y2) {
                                if(data[i].url == undefined){
                                    $("#resultClick").append("<br> <span > no URL found to register for event " + eventNum  +"</span> ");
                                }else{
                                    $("#resultClick").append("<br> <a href='" + data[i].url +"'> Click to register event "+ eventNum  +"</a> ");
                                }
                                eventNum = eventNum+1;
                            }
                        }
                    }
                }

            });

        });// END OF JSON FILE LOAD 



});//END OF FUNCTION LOAD DOCUMNET
</script>



</body>
</html>
